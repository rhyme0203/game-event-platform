<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🎰</text></svg>">
  <title>럭키빤쓰 - 슬롯머신</title>
  <link rel="stylesheet" href="../assets/css/common.css">
  <link rel="stylesheet" href="../assets/css/ad-modal.css">
  <link rel="stylesheet" href="../assets/css/point-system.css">
  
  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8451876651536601"
       crossorigin="anonymous"></script>
  
  <!-- AdSense 코드 스니펫 -->
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-8451876651536601",
      enable_page_level_ads: true
    });
  </script>
  <style>
    .slot-machine {
      background: linear-gradient(145deg, #2c3e50, #34495e);
      border-radius: 30px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      max-width: 450px;
      margin: 0 auto;
    }

    .slot-display {
      background: #1a1a1a;
      border-radius: 20px;
      padding: 30px 20px;
      margin-bottom: 30px;
      display: flex;
      justify-content: center;
      gap: 15px;
      box-shadow: inset 0 5px 15px rgba(0, 0, 0, 0.8);
    }

    .slot-reel {
      width: 100px;
      height: 120px;
      background: white;
      border-radius: 15px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .slot-symbols {
      display: flex;
      flex-direction: column;
      position: absolute;
      width: 100%;
      height: 100%;
      transition: transform 0.1s linear;
      align-items: center;
      justify-content: flex-start;
    }

    .slot-symbol {
      height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 60px;
      user-select: none;
    }

    .slot-lever {
      width: 60px;
      height: 120px;
      background: linear-gradient(145deg, #e74c3c, #c0392b);
      border-radius: 30px;
      margin: 0 auto 30px;
      position: relative;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      transition: all 0.2s ease;
    }

    .slot-lever:hover:not(.pulling) {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
    }

    .slot-lever.pulling {
      transform: translateY(20px);
    }

    .slot-lever::before {
      content: '⬇️';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 30px;
    }

    .jackpot-text {
      text-align: center;
      font-size: 1.5em;
      font-weight: 700;
      color: #f1c40f;
      margin-bottom: 20px;
      text-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
    }

    .prize-list {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 20px;
      margin-top: 20px;
      backdrop-filter: blur(10px);
    }

    .prize-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px;
      color: white;
      font-size: 0.95em;
    }

    .prize-symbols {
      font-size: 24px;
    }

    @media (max-width: 600px) {
      .slot-machine {
        padding: 30px 20px;
      }
      .slot-reel {
        width: 80px;
        height: 100px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .slot-symbol {
        height: 100px;
        width: 100%;
        font-size: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        line-height: 1;
        box-sizing: border-box;
      }
      .slot-symbols {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        width: 100%;
        height: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="game-card">
      <h1>🎰 슬롯머신</h1>
      <p class="subtitle">3개의 그림을 맞춰보세요!</p>

      <div class="game-area">
        <div class="slot-machine">
          <div class="jackpot-text">🌟 JACKPOT 🌟</div>
          
          <div class="slot-display">
            <div class="slot-reel">
              <div class="slot-symbols" id="reel1"></div>
            </div>
            <div class="slot-reel">
              <div class="slot-symbols" id="reel2"></div>
            </div>
            <div class="slot-reel">
              <div class="slot-symbols" id="reel3"></div>
            </div>
          </div>

          <div class="slot-lever" id="lever"></div>

          <div class="prize-list">
            <div class="prize-item">
              <span class="prize-symbols">🍒 🍒 🍒</span>
              <span>5,000 포인트</span>
            </div>
            <div class="prize-item">
              <span class="prize-symbols">🍋 🍋 🍋</span>
              <span>3,000 포인트</span>
            </div>
            <div class="prize-item">
              <span class="prize-symbols">🍊 🍊 🍊</span>
              <span>2,000 포인트</span>
            </div>
            <div class="prize-item">
              <span class="prize-symbols">⭐ ⭐ ⭐</span>
              <span>1,000 포인트</span>
            </div>
            <div class="prize-item">
              <span class="prize-symbols">동일 2개</span>
              <span>500 포인트</span>
            </div>
          </div>
        </div>
      </div>

      <div class="info-box">
        <p><strong>게임 방법</strong></p>
        <p>레버를 당겨 슬롯을 돌리고, 같은 그림을 맞추면 포인트를 획득합니다!</p>
        <p>3개를 모두 맞추면 대박!</p>
      </div>

      <a href="../index.html" class="back-link">← 메인으로 돌아가기</a>
    </div>
  </div>

  <!-- 결과 모달 -->
  <div class="result-modal" id="resultModal">
    <div class="result-content">
      <div class="result-icon" id="resultIcon">🎉</div>
      <div class="result-title" id="resultTitle">축하합니다!</div>
      <div class="result-prize" id="prizeText"></div>
      <button class="close-button" id="closeBtn">확인</button>
    </div>
  </div>

  <!-- 광고 모달 -->
  <div class="ad-modal" id="adModal">
    <div class="ad-modal-content">
      <button class="ad-modal-close" onclick="closeAdModalAndSpin()">&times;</button>
      
      <div class="ad-modal-header">
        <div class="ad-modal-title">🎯 특별 이벤트!</div>
        <div class="ad-modal-subtitle">럭키빤쓰 프리미엄 서비스를 확인해보세요</div>
      </div>
      
      <div class="ad-modal-body">
        <div class="ad-modal-ad">
          <!-- Google AdSense 광고 -->
          <ins class="adsbygoogle"
               style="display:block;width:300px;height:250px;"
               data-ad-client="ca-pub-8451876651536601"
               data-ad-slot="5939741579"></ins>
          <div class="ad-modal-ad-placeholder" style="display:none;">
            광고 로딩 중...
          </div>
        </div>
        
        <div class="ad-modal-countdown" id="countdown" style="display:none;">
          <span id="countdownText">5</span>초 후 게임 시작
        </div>
      </div>
      
      <div class="ad-modal-footer">
        <button class="ad-modal-btn ad-modal-btn-primary" onclick="startGame()" id="startGameBtn">
          게임 시작하기
        </button>
        <button class="ad-modal-btn ad-modal-btn-secondary" onclick="skipAd()">
          광고 건너뛰기
        </button>
      </div>
    </div>
  </div>

  <script>
    const symbols = ['🍒', '🍋', '🍊', '⭐', '🍇', '🍉', '💎', '🎰'];
    const prizes = {
      '🍒🍒🍒': '5,000 포인트',
      '🍋🍋🍋': '3,000 포인트',
      '🍊🍊🍊': '2,000 포인트',
      '⭐⭐⭐': '1,000 포인트',
      '🍇🍇🍇': '1,000 포인트',
      '🍉🍉🍉': '1,000 포인트',
      '💎💎💎': '10,000 포인트 (JACKPOT!)',
      '🎰🎰🎰': '10,000 포인트 (JACKPOT!)'
    };

    let isSpinning = false;
    const lever = document.getElementById('lever');
    const resultModal = document.getElementById('resultModal');
    const resultIcon = document.getElementById('resultIcon');
    const resultTitle = document.getElementById('resultTitle');
    const prizeText = document.getElementById('prizeText');
    const closeBtn = document.getElementById('closeBtn');

    // 릴 초기화
    function initReels() {
      for (let i = 1; i <= 3; i++) {
        const reel = document.getElementById(`reel${i}`);
        // 여러 심볼 생성 (스크롤 효과용)
        for (let j = 0; j < 30; j++) {
          const symbol = document.createElement('div');
          symbol.className = 'slot-symbol';
          symbol.textContent = symbols[Math.floor(Math.random() * symbols.length)];
          reel.appendChild(symbol);
        }
      }
    }

    // 광고 모달 표시
    function showAdModal() {
      console.log('광고 모달 표시');
      const modal = document.getElementById('adModal');
      modal.classList.add('show');
    }
    
    // 광고 모달 닫기
    function closeAdModal() {
      const modal = document.getElementById('adModal');
      modal.classList.remove('show');
    }
    
    // 광고 모달 닫고 스핀 시작
    function closeAdModalAndSpin() {
      console.log('X 버튼으로 모달 닫기');
      closeAdModal();
      setTimeout(() => {
        if (!isSpinning) {
          spin();
        }
      }, 300);
    }
    
    // 게임 시작
    function startGame() {
      console.log('게임 시작!');
      startCountdown();
    }
    
    // 광고 건너뛰기
    function skipAd() {
      console.log('광고 건너뛰기');
      closeAdModal();
      setTimeout(() => {
        if (!isSpinning) {
          spin();
        }
      }, 300);
    }
    
    // 카운트다운 시작
    function startCountdown() {
      const countdown = document.getElementById('countdown');
      const countdownText = document.getElementById('countdownText');
      const startBtn = document.getElementById('startGameBtn');
      
      countdown.style.display = 'block';
      startBtn.style.display = 'none';
      
      let timeLeft = 5;
      countdownText.textContent = timeLeft;
      
      const timer = setInterval(() => {
        timeLeft--;
        countdownText.textContent = timeLeft;
        
        if (timeLeft <= 0) {
          clearInterval(timer);
          closeAdModal();
          setTimeout(() => {
            if (!isSpinning) {
              spin();
            }
          }, 300);
        }
      }, 1000);
    }

    // 슬롯 돌리기
    function spin() {
      if (isSpinning) return;
      
      isSpinning = true;
      lever.classList.add('pulling');
      
      setTimeout(() => {
        lever.classList.remove('pulling');
      }, 300);

      const results = [];
      const durations = [2000, 2500, 3000];

      for (let i = 1; i <= 3; i++) {
        const reel = document.getElementById(`reel${i}`);
        const duration = durations[i - 1];
        
        // 릴 회전 애니메이션
        let distance = 0;
        const interval = setInterval(() => {
          distance += 20;
          reel.style.transform = `translateY(-${distance}px)`;
        }, 16);

        setTimeout(() => {
          clearInterval(interval);
          
          // 최종 결과 심볼 선택
          const finalSymbol = symbols[Math.floor(Math.random() * symbols.length)];
          results.push(finalSymbol);
          
          // 최종 위치로 스냅 (가시 영역의 중앙에 위치)
          const symbolHeight = 120;
          const visibleIndex = 1; // 가시 영역의 중앙 (0, 1, 2 중 1번째)
          const finalPosition = visibleIndex * symbolHeight;
          reel.style.transform = `translateY(-${finalPosition}px)`;
          
          // 가시 영역의 중앙 심볼을 최종 결과로 설정
          if (reel.children[visibleIndex]) {
            reel.children[visibleIndex].textContent = finalSymbol;
          }
          
          // 릴의 모든 심볼을 최종 결과로 업데이트 (시각적 일관성)
          for (let j = 0; j < reel.children.length; j++) {
            if (j === visibleIndex) {
              reel.children[j].textContent = finalSymbol;
            } else {
              reel.children[j].textContent = symbols[Math.floor(Math.random() * symbols.length)];
            }
          }
          
          if (i === 3) {
            setTimeout(() => {
              checkResults(results);
            }, 500);
          }
        }, duration);
      }
    }

    // 결과 확인
    function checkResults(results) {
      isSpinning = false;
      
      const key = results.join('');
      let prize = '';
      let icon = '🎉';
      let title = '축하합니다!';

      if (prizes[key]) {
        // 3개 모두 일치
        prize = prizes[key];
        if (key.includes('💎') || key.includes('🎰')) {
          icon = '💎';
          title = 'JACKPOT!!!';
        }
      } else if (results[0] === results[1] || results[1] === results[2] || results[0] === results[2]) {
        // 2개 일치
        prize = '500 포인트';
      } else {
        // 꽝
        prize = '아쉽게도 다음 기회에...';
        icon = '😢';
        title = '아쉽네요!';
      }

      showResult(icon, title, prize);
    }

    // 결과 표시
    function showResult(icon, title, prize) {
      resultIcon.textContent = icon;
      resultTitle.textContent = title;
      prizeText.textContent = prize;
      resultModal.classList.add('show');
    }

    // 모달 닫기
    function closeModal() {
      resultModal.classList.remove('show');
    }

    // 이벤트 리스너
    lever.addEventListener('click', showAdModal);
    closeBtn.addEventListener('click', closeModal);
    resultModal.addEventListener('click', (e) => {
      if (e.target === resultModal) closeModal();
    });

    // 포인트 시스템 추가
    const pointSystemScript = document.createElement('script');
    pointSystemScript.src = '../assets/js/point-system.js';
    document.head.appendChild(pointSystemScript);
    
    // 포인트 지급 로직 (슬롯머신 결과에 따라)
    function awardPoints(result) {
      if (window.pointSystem) {
        if (result.won) {
          const pointAmount = result.prize === '잭팟' ? 1000 : 
                            result.prize === '대박' ? 500 : 
                            result.prize === '보너스' ? 200 : 50;
          window.pointSystem.addPoints(pointAmount, `슬롯머신 당첨: ${result.prize}`);
        } else {
          window.pointSystem.addPoints(10, '슬롯머신 참여');
        }
      }
    }
    
    // 초기화
    initReels();
  </script>
</body>
</html>

