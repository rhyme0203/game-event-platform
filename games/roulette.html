<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🎰</text></svg>">
  <title>럭키빤쓰 - 행운의 룰렛</title>
  <link rel="stylesheet" href="../assets/css/common.css">
  <link rel="stylesheet" href="../assets/css/ads.css">
  <link rel="stylesheet" href="../assets/css/ad-modal.css">
  <link rel="stylesheet" href="../assets/css/point-system.css">
  
  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8451876651536601" crossorigin="anonymous"></script>
  
  <style>
    body {
      background: white !important;
      margin: 0;
      padding: 0;
    }
    
    .game-container {
      max-width: 400px;
      margin: 0 auto;
      padding: 20px;
      text-align: center;
    }
    
    .roulette-wheel {
      width: 300px;
      height: 300px;
      border-radius: 50%;
      border: 8px solid #333;
      position: relative;
      margin: 20px auto;
      background: conic-gradient(
        #ff6b6b 0deg 45deg,
        #4ecdc4 45deg 90deg,
        #45b7d1 90deg 135deg,
        #96ceb4 135deg 180deg,
        #feca57 180deg 225deg,
        #ff9ff3 225deg 270deg,
        #54a0ff 270deg 315deg,
        #5f27cd 315deg 360deg
      );
      transition: transform 3s cubic-bezier(0.23, 1, 0.32, 1);
    }
    
    .roulette-wheel.spinning {
      animation: spin 3s cubic-bezier(0.23, 1, 0.32, 1);
    }
    
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(1800deg); }
    }
    
    .roulette-pointer {
      position: absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-bottom: 30px solid #333;
      z-index: 10;
    }
    
    .prize-section {
      margin: 20px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 10px;
    }
    
    .prize-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    
    .prize-item:last-child {
      border-bottom: none;
    }
    
    .prize-name {
      font-weight: bold;
      color: #333;
    }
    
    .prize-probability {
      color: #666;
      font-size: 14px;
    }
    
    .attempts-info {
      margin: 15px 0;
      font-size: 16px;
      color: #333;
    }
    
    .start-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 18px;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: block;
      margin: 20px auto;
      text-align: center;
    }
    
    .start-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .start-button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    
    .result-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
    }
    
    .result-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      max-width: 300px;
      width: 90%;
    }
    
    .result-prize {
      font-size: 24px;
      font-weight: bold;
      color: #333;
      margin: 20px 0;
    }
    
    .result-actions {
      margin-top: 20px;
    }
    
    .result-actions button {
      background: #667eea;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      margin: 0 5px;
    }
    
    .ad-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
    }
    
    .ad-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      max-width: 300px;
      width: 90%;
    }
    
    .ad-placeholder {
      background: #f0f0f0;
      height: 250px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px dashed #ccc;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <h1>🎰 행운의 룰렛</h1>
    
    <div class="roulette-wheel" id="rouletteWheel">
      <div class="roulette-pointer"></div>
    </div>
    
    <div class="prize-section">
      <h3>🎁 경품 목록</h3>
      <div id="prizeList"></div>
    </div>
    
    <div class="attempts-info">
      남은 시도 횟수: <span id="remainingAttempts">3</span>회
    </div>
    
    <button class="start-button" id="spinBtn">룰렛 돌리기</button>
  </div>
  
  <!-- 결과 모달 -->
  <div class="result-modal" id="resultModal">
    <div class="result-content">
      <h2>🎉 축하합니다!</h2>
      <div class="result-prize" id="resultPrize"></div>
      <div class="result-actions">
        <button onclick="closeResultModal()">확인</button>
        <button onclick="showAdModal()">광고 보기</button>
      </div>
    </div>
  </div>
  
  <!-- 광고 모달 -->
  <div class="ad-modal" id="adModal">
    <div class="ad-content">
      <h3>광고를 시청해주세요</h3>
      <div class="ad-placeholder" id="adPlaceholder">
        광고 로딩 중...
      </div>
      <button onclick="closeAdModal()">닫기</button>
    </div>
  </div>
  
  <!-- 포인트 시스템 -->
  <script src="../assets/js/point-system.js"></script>
  
  <script>
    console.log('룰렛 게임 시작!');
    
    // 게임 상태
    let isSpinning = false;
    let remaining = 3;
    let selectedPrize = null;
    
    // 기본 경품 데이터
    const defaultPrizes = [
      { name: "100포인트", probability: 30, points: 100 },
      { name: "200포인트", probability: 25, points: 200 },
      { name: "500포인트", probability: 20, points: 500 },
      { name: "1000포인트", probability: 15, points: 1000 },
      { name: "꽝", probability: 10, points: 0 }
    ];
    
    let prizes = [...defaultPrizes];
    
    // DOM 요소들
    const rouletteWheel = document.getElementById('rouletteWheel');
    const spinBtn = document.getElementById('spinBtn');
    const remainingAttempts = document.getElementById('remainingAttempts');
    const prizeList = document.getElementById('prizeList');
    const resultModal = document.getElementById('resultModal');
    const resultPrize = document.getElementById('resultPrize');
    const adModal = document.getElementById('adModal');
    const adPlaceholder = document.getElementById('adPlaceholder');
    
    // 포인트 시스템 초기화
    let pointSystem = null;
    
    // 페이지 로드 시 초기화
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM 로드 완료');
      
      // 포인트 시스템 초기화
      if (window.PointSystem) {
        pointSystem = new window.PointSystem();
        console.log('포인트 시스템 로드됨');
      }
      
      // 경품 목록 표시
      displayPrizes();
      
      // 이벤트 리스너 등록
      spinBtn.addEventListener('click', spin);
      
      console.log('룰렛 게임 초기화 완료');
    });
    
    // 경품 목록 표시
    function displayPrizes() {
      prizeList.innerHTML = '';
      prizes.forEach(prize => {
        const prizeItem = document.createElement('div');
        prizeItem.className = 'prize-item';
        prizeItem.innerHTML = `
          <span class="prize-name">${prize.name}</span>
          <span class="prize-probability">${prize.probability}%</span>
        `;
        prizeList.appendChild(prizeItem);
      });
    }
    
    // 룰렛 돌리기
    function spin() {
      if (isSpinning || remaining <= 0) return;
      
      console.log('룰렛 돌리기 시작');
      isSpinning = true;
      spinBtn.disabled = true;
      spinBtn.textContent = '돌리는 중...';
      
      // 룰렛 회전 애니메이션
      rouletteWheel.classList.add('spinning');
      
      // 3초 후 결과 결정
      setTimeout(() => {
        selectPrize();
        rouletteWheel.classList.remove('spinning');
        showResult();
        isSpinning = false;
        spinBtn.disabled = false;
        spinBtn.textContent = '룰렛 돌리기';
      }, 3000);
    }
    
    // 경품 선택
    function selectPrize() {
      const random = Math.random() * 100;
      let cumulative = 0;
      
      for (let prize of prizes) {
        cumulative += prize.probability;
        if (random <= cumulative) {
          selectedPrize = prize;
          break;
        }
      }
      
      console.log('선택된 경품:', selectedPrize);
    }
    
    // 결과 표시
    function showResult() {
      remaining--;
      remainingAttempts.textContent = remaining;
      
      if (selectedPrize) {
        resultPrize.textContent = selectedPrize.name;
        
        // 포인트 지급
        if (selectedPrize.points > 0 && pointSystem) {
          pointSystem.addPoints(selectedPrize.points, `룰렛 게임: ${selectedPrize.name}`);
          console.log(`${selectedPrize.points}포인트 지급됨`);
        }
      }
      
      resultModal.style.display = 'block';
      
      // 시도 횟수 확인
      if (remaining <= 0) {
        setTimeout(() => {
          spinBtn.textContent = '시도 횟수 초과';
          spinBtn.disabled = true;
        }, 1000);
      }
    }
    
    // 결과 모달 닫기
    function closeResultModal() {
      resultModal.style.display = 'none';
    }
    
    // 광고 모달 표시
    function showAdModal() {
      resultModal.style.display = 'none';
      adModal.style.display = 'block';
      
      // AdSense 광고 로드
      setTimeout(() => {
        try {
          (adsbygoogle = window.adsbygoogle || []).push({});
          console.log('AdSense 광고 로드됨');
        } catch (error) {
          console.error('AdSense 오류:', error);
        }
      }, 100);
      
      // 3초 후 광고 완료 처리
      setTimeout(() => {
        adPlaceholder.textContent = '광고 시청 완료!';
        adPlaceholder.style.background = '#d4edda';
        adPlaceholder.style.color = '#155724';
      }, 3000);
    }
    
    // 광고 모달 닫기
    function closeAdModal() {
      adModal.style.display = 'none';
      
      // 광고 시청 후 보너스 포인트 지급
      if (pointSystem) {
        pointSystem.addPoints(50, '광고 시청 보너스');
        console.log('광고 시청 보너스 50포인트 지급됨');
      }
    }
    
    // 전역 함수로 등록
    window.closeResultModal = closeResultModal;
    window.showAdModal = showAdModal;
    window.closeAdModal = closeAdModal;
  </script>
</body>
</html>