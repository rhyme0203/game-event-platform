<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ°</text></svg>">
  <title>ëŸ­í‚¤ë¹¤ì“° - í–‰ìš´ì˜ ë£°ë ›</title>
  <link rel="stylesheet" href="../assets/css/common.css">
  <link rel="stylesheet" href="../assets/css/ads.css">
  <link rel="stylesheet" href="../assets/css/ad-modal.css">
  <link rel="stylesheet" href="../assets/css/point-system.css">
  
  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8451876651536601"
       crossorigin="anonymous"></script>
  
  <!-- AdSense ì½”ë“œ ìŠ¤ë‹ˆí« -->
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-8451876651536601",
      enable_page_level_ads: true
    });
  </script>
  <style>
    /* Body ë°°ê²½ìƒ‰ í°ìƒ‰ìœ¼ë¡œ ì„¤ì • */
    body {
      background: white !important;
      margin: 0;
      padding: 0;
    }

    .roulette-container {
      position: relative;
      width: 400px;
      height: 400px;
      margin: 0 auto;
    }

    .roulette-wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      position: relative;
      transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
      box-shadow: 0 0 0 15px #fff, 0 0 0 18px var(--primary-color), 0 10px 50px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }

    .roulette-wheel.spinning {
      transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
    }

    .roulette-wheel.stopped {
      transition: none;
    }

    .roulette-canvas {
      width: 100%;
      height: 100%;
    }

    .roulette-pin {
      position: absolute;
      top: -25px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-top: 35px solid var(--danger-color);
      z-index: 10;
      filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.3));
    }

    .roulette-center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80px;
      height: 80px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      z-index: 5;
    }

    .spin-count {
      margin-top: 30px;
      font-size: 1.1em;
      color: #666;
      font-weight: 600;
    }

    .spin-count span {
      color: var(--primary-color);
      font-size: 1.3em;
      font-weight: 700;
    }

    /* ë¡œë”© ìƒíƒœ ìŠ¤íƒ€ì¼ */
    .loading-state {
      text-align: center;
      padding: 40px 20px;
      color: #666;
    }

    .loading-spinner {
      font-size: 3em;
      margin-bottom: 20px;
      animation: spin 2s linear infinite;
    }

    .loading-text {
      font-size: 1.2em;
      font-weight: 600;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ì´ˆê¸° ë¡œë”© ìƒíƒœì—ì„œ ë²„íŠ¼ ìˆ¨ê¹€ */
    #spinBtn {
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    #spinBtn.loaded {
      opacity: 1;
      visibility: visible;
    }

    @media (max-width: 600px) {
      .roulette-container {
        width: 300px;
        height: 300px;
      }
      .roulette-center {
        width: 60px;
        height: 60px;
        font-size: 28px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="game-card">
      <h1>ğŸ¡ í–‰ìš´ì˜ ë£°ë ›</h1>
      <p class="subtitle">ë£°ë ›ì„ ëŒë ¤ ê²½í’ˆì„ ë°›ì•„ê°€ì„¸ìš”!</p>

      <div class="game-area">
        <div class="roulette-container">
          <div class="roulette-pin"></div>
          <div class="roulette-wheel" id="wheel">
            <canvas id="rouletteCanvas" class="roulette-canvas"></canvas>
          </div>
          <div class="roulette-center">ğŸ</div>
        </div>
        
        <!-- ë¡œë”© ìƒíƒœ í‘œì‹œ -->
        <div id="loadingState" class="loading-state">
          <div class="loading-spinner">â³</div>
          <div class="loading-text">ê²Œì„ ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
        
        <div class="spin-count" id="spinCount" style="display: none;">
          ë‚¨ì€ ê¸°íšŒ: <span id="remaining">3</span>íšŒ
        </div>
      </div>

      <button class="start-button" id="spinBtn" onclick="showAdModal()">ë£°ë › ëŒë¦¬ê¸°</button>

      <div class="info-box">
        <p><strong>ì°¸ì—¬ ë°©ë²•</strong></p>
        <p>ë²„íŠ¼ì„ ëˆŒëŸ¬ ë£°ë ›ì„ ëŒë¦¬ë©´ ìë™ìœ¼ë¡œ ê²½í’ˆì´ ì¶”ì²¨ë©ë‹ˆë‹¤.</p>
        <p>í•˜ë£¨ 3íšŒê¹Œì§€ ì°¸ì—¬ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
      </div>

      <a href="../index.html" class="back-link">â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>
  </div>

  <!-- ê²°ê³¼ ëª¨ë‹¬ -->
  <div class="result-modal" id="resultModal">
    <div class="result-content">
      <div class="result-icon">ğŸ‰</div>
      <div class="result-title">ì¶•í•˜í•©ë‹ˆë‹¤!</div>
      <div class="result-prize" id="prizeText"></div>
      
      
      <button class="close-button" id="closeBtn">í™•ì¸</button>
    </div>
  </div>

  <!-- ê´‘ê³  ëª¨ë‹¬ -->
  <div class="ad-modal" id="adModal">
    <div class="ad-modal-content">
      <button class="ad-modal-close" onclick="closeAdModalAndSpin()">&times;</button>
      
      <div class="ad-modal-header">
        <div class="ad-modal-title">ğŸ¯ íŠ¹ë³„ ì´ë²¤íŠ¸!</div>
        <div class="ad-modal-subtitle">ëŸ­í‚¤ë¹¤ì“° í”„ë¦¬ë¯¸ì—„ ì„œë¹„ìŠ¤ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”</div>
      </div>
      
      <div class="ad-modal-body">
        <div class="ad-modal-ad">
          <!-- ë£°ë ›ê´‘ê³  -->
          <ins class="adsbygoogle"
               style="display:block;width:100%;height:250px;"
               data-ad-client="ca-pub-8451876651536601"
               data-ad-slot="4076493332"
               data-ad-format="auto"
               data-full-width-responsive="true"></ins>
          <div class="ad-modal-ad-placeholder" id="adPlaceholder">
            ê´‘ê³  ë¡œë”© ì¤‘...
          </div>
        </div>
        
        <div class="ad-modal-countdown" id="countdown" style="display:none;">
          <span id="countdownText">5</span>ì´ˆ í›„ ê²Œì„ ì‹œì‘
        </div>
      </div>
      
      <div class="ad-modal-footer">
        <button class="ad-modal-btn ad-modal-btn-primary" onclick="startGame()" id="startGameBtn">
          ê²Œì„ ì‹œì‘í•˜ê¸°
        </button>
        <button class="ad-modal-btn ad-modal-btn-secondary" onclick="skipAd()">
          ê´‘ê³  ê±´ë„ˆë›°ê¸°
        </button>
      </div>
    </div>
  </div>

  <!-- GitHub DB ìŠ¤í¬ë¦½íŠ¸ (ìš°ì„ ) -->
  <script src="../assets/js/github-db.js"></script>
  <!-- SQL API ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="../assets/js/sql-api.js"></script>
  <!-- ê´€ë¦¬ì í†µí•© ìŠ¤í¬ë¦½íŠ¸ (í´ë°±ìš©) -->
  <script src="../assets/js/admin-integration.js"></script>
  <!-- í¬ì¸íŠ¸ ì‹œìŠ¤í…œ -->
  <script src="../assets/js/point-system.js"></script>
  
  <script>
    console.log('ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œë¨!');
    
    // GitHub DB ì´ˆê¸°í™”
    if (typeof GitHubDatabase !== 'undefined') {
      window.githubDB = new GitHubDatabase();
      console.log('GitHub DB ì´ˆê¸°í™”ë¨');
    }
    
    // ë¡œë”© ìƒíƒœ ê´€ë¦¬
    let isLoading = true;
    let isDataLoaded = false;
    
    // ê²½í’ˆ ë°ì´í„° (ì´ˆê¸°ì—ëŠ” ë¹ˆ ë°°ì—´, SQL APIì—ì„œ ë¡œë“œ í›„ ì—…ë°ì´íŠ¸)
    let prizes = [];
    let remaining = 3;
    let isSpinning = false;
    let currentRotation = 0;
    let currentAttempts = 3;
    const maxAttempts = 3;
    const spinDuration = 4000; // 4ì´ˆ
    
    // GitHub Pagesìš© ê¸°ë³¸ ìƒí’ˆ ë°ì´í„°
    const defaultPrizes = [
      { id: 1, name: "ê½", probability: 0.3, color: "#ff6b6b" },
      { id: 2, name: "100ì›", probability: 0.2, color: "#4ecdc4" },
      { id: 3, name: "500ì›", probability: 0.15, color: "#45b7d1" },
      { id: 4, name: "1000ì›", probability: 0.1, color: "#96ceb4" },
      { id: 5, name: "5000ì›", probability: 0.05, color: "#feca57" },
      { id: 6, name: "10000ì›", probability: 0.05, color: "#ff9ff3" },
      { id: 7, name: "50000ì›", probability: 0.03, color: "#54a0ff" },
      { id: 8, name: "100000ì›", probability: 0.02, color: "#5f27cd" }
    ];

    // DOM ìš”ì†Œ
    let wheel, canvas, ctx, spinBtn, resultModal, prizeText, closeBtn, remainingText;
    
    // í¬ì¸íŠ¸ ê³„ì‚° í•¨ìˆ˜
    function calculatePointReward(prize) {
      const pointMap = {
        'ê½': 0,
        '100ì›': 10,
        '500ì›': 50,
        '1000ì›': 100,
        '5000ì›': 500,
        '10000ì›': 1000,
        '50000ì›': 5000,
        '100000ì›': 10000
      };
      
      return pointMap[prize.name] || 0;
    }
    
    // spin í•¨ìˆ˜ë¥¼ ì „ì—­ìœ¼ë¡œ ì„ ì–¸
    window.spin = function() {
      console.log('=== spin() í•¨ìˆ˜ í˜¸ì¶œë¨! ===');
      console.log('isSpinning:', isSpinning);
      console.log('remaining:', remaining);
      console.log('isLoading:', isLoading);
      console.log('isDataLoaded:', isDataLoaded);
      
      // ë°ì´í„° ë¡œë”© ì¤‘ì´ë©´ ëŒ€ê¸°
      if (isLoading || !isDataLoaded) {
        console.log('ë°ì´í„° ë¡œë”© ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
      if (isSpinning) {
        console.log('ì´ë¯¸ ëŒì•„ê°€ëŠ” ì¤‘ì…ë‹ˆë‹¤');
        return;
      }
      
      if (remaining <= 0) {
        console.log('ì°¸ì—¬ ê¸°íšŒê°€ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤');
        return;
      }
      
      isSpinning = true;
      if (spinBtn) {
        spinBtn.disabled = true;
        spinBtn.textContent = 'ëŒì•„ê°€ëŠ” ì¤‘...';
      }
      
      const selectedIndex = selectPrize();
      const selectedPrize = prizes[selectedIndex]; // selectedPrize ë³€ìˆ˜ ì •ì˜
      const sectionAngle = 360 / prizes.length;
      
      // ìµœì†Œ 5ë°”í€´ + ì„ íƒëœ ì„¹ì…˜ìœ¼ë¡œ ì´ë™
      const minRotation = 360 * 5;
      const targetRotation = minRotation + (360 - (selectedIndex * sectionAngle)) - (sectionAngle / 2);
      currentRotation += targetRotation;
      
      console.log('ì„ íƒëœ ê²½í’ˆ:', selectedPrize.name);
      console.log('íšŒì „ ê°ë„:', currentRotation);
      
      if (wheel) {
        // íšŒì „ ì‹œì‘ í´ë˜ìŠ¤ ì¶”ê°€
        wheel.classList.remove('stopped');
        wheel.classList.add('spinning');
        
        // ê°•ì œ ë¦¬í”Œë¡œìš° í›„ íšŒì „ ì ìš©
        wheel.offsetHeight;
        wheel.style.transform = `rotate(${currentRotation}deg)`;
      }
      
      // íšŒì „ ì™„ë£Œ í›„ ì²˜ë¦¬
      setTimeout(() => {
        console.log('íšŒì „ ì™„ë£Œ, ê²°ê³¼ ì²˜ë¦¬ ì‹œì‘');
        
        // íšŒì „ ì™„ë£Œ í´ë˜ìŠ¤ë¡œ ë³€ê²½
        if (wheel) {
          wheel.classList.remove('spinning');
          wheel.classList.add('stopped');
        }
        
        // ìƒíƒœ ì´ˆê¸°í™”
        isSpinning = false;
        remaining--;
        if (remainingText) remainingText.textContent = remaining;
        
        // í¬ì¸íŠ¸ ì§€ê¸‰ ë¡œì§
        if (selectedPrize.probability > 0) {
          // ë‹¹ì²¨ ì‹œ í¬ì¸íŠ¸ ì§€ê¸‰
          const pointAmount = calculatePointReward(selectedPrize);
          if (window.pointSystem) {
            window.pointSystem.addPoints(pointAmount, `ë£°ë › ë‹¹ì²¨: ${selectedPrize.name}`);
          }
        } else {
          // ê½ ì‹œì—ë„ ì°¸ì—¬ í¬ì¸íŠ¸ ì§€ê¸‰
          if (window.pointSystem) {
            window.pointSystem.addPoints(10, 'ë£°ë › ì°¸ì—¬');
          }
        }
        
        // ê²Œì„ í”Œë ˆì´ ê¸°ë¡ (SQL API ìš°ì„ , í´ë°±)
        if (window.sqlAdminIntegration) {
          window.sqlAdminIntegration.recordGamePlay('roulette', {
            won: selectedPrize.probability > 0,
            prize: selectedPrize.name,
            value: selectedPrize.probability > 0 ? 1000 : 0,
            timestamp: new Date().toISOString()
          });
        } else if (window.adminIntegration) {
          window.adminIntegration.recordGamePlay('roulette', {
            won: selectedPrize.probability > 0,
            prize: selectedPrize.name,
            timestamp: new Date().toISOString()
          });
        }
        
        // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        if (remaining > 0) {
          if (spinBtn) {
            spinBtn.disabled = false;
            spinBtn.textContent = 'ë£°ë › ëŒë¦¬ê¸°';
          }
        } else {
          if (spinBtn) {
            spinBtn.textContent = 'ì°¸ì—¬ ê¸°íšŒ ì†Œì§„';
          }
        }
        
        // ê²°ê³¼ í‘œì‹œ
        showResult(selectedPrize.name);
        console.log('ê²°ê³¼ í‘œì‹œ ì™„ë£Œ');
      }, spinDuration); // ì„¤ì •ëœ íšŒì „ ì‹œê°„ ì‚¬ìš©
    };

    // í˜ì´ì§€ ë¡œë“œ í›„ ì´ˆê¸°í™”
    window.addEventListener('DOMContentLoaded', function() {
      console.log('=== í˜ì´ì§€ ë¡œë“œ ì‹œì‘ ===');
      
      wheel = document.getElementById('wheel');
      canvas = document.getElementById('rouletteCanvas');
      spinBtn = document.getElementById('spinBtn');
      resultModal = document.getElementById('resultModal');
      prizeText = document.getElementById('prizeText');
      closeBtn = document.getElementById('closeBtn');
      remainingText = document.getElementById('remaining');

      console.log('wheel:', wheel);
      console.log('canvas:', canvas);
      console.log('spinBtn:', spinBtn);
      
      if (!canvas) {
        console.error('Canvasë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
        return;
      }
      
      ctx = canvas.getContext('2d');
      console.log('ctx:', ctx);

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ë£°ë › ëŒë¦¬ê¸° ë²„íŠ¼ì€ onclickìœ¼ë¡œ ì²˜ë¦¬)
      console.log('ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” onclickìœ¼ë¡œ ì²˜ë¦¬ë¨');
      
      closeBtn.addEventListener('click', closeModal);
      resultModal.addEventListener('click', (e) => {
        if (e.target === resultModal) closeModal();
      });

      // ë£°ë › ì´ˆê¸°í™”
      console.log('ë£°ë › ì´ˆê¸°í™” ì‹œì‘');
      createWheel();
      
      // ì´ˆê¸° ìƒíƒœ ì„¤ì •
      if (wheel) {
        wheel.classList.add('stopped');
        wheel.classList.remove('spinning');
      }
      
      console.log('=== ì´ˆê¸°í™” ì™„ë£Œ ===');
    });

    // Canvas í¬ê¸° ì„¤ì •
    function setCanvasSize() {
      const size = wheel.offsetWidth;
      canvas.width = size;
      canvas.height = size;
      drawWheel();
    }

    // ë£°ë › ì›íŒ ê·¸ë¦¬ê¸°
    function drawWheel() {
      console.log('drawWheel í˜¸ì¶œë¨, canvas í¬ê¸°:', canvas.width, 'x', canvas.height);
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius = canvas.width / 2;
      const sectionAngle = (Math.PI * 2) / prizes.length;

      prizes.forEach((prize, index) => {
        const startAngle = index * sectionAngle - Math.PI / 2;
        const endAngle = startAngle + sectionAngle;

        // ì„¹ì…˜ ê·¸ë¦¬ê¸°
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, startAngle, endAngle);
        ctx.closePath();
        ctx.fillStyle = prize.color;
        ctx.fill();
        
        // í…Œë‘ë¦¬
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 3;
        ctx.stroke();

        // í…ìŠ¤íŠ¸
        ctx.save();
        ctx.translate(centerX, centerY);
        ctx.rotate(startAngle + sectionAngle / 2);
        ctx.textAlign = 'center';
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 16px Pretendard, Arial, sans-serif';
        ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
        ctx.shadowBlur = 4;
        ctx.shadowOffsetX = 2;
        ctx.shadowOffsetY = 2;
        ctx.fillText(prize.name, radius * 0.6, 5);
        ctx.restore();
      });
      
      console.log('ì›íŒ ê·¸ë¦¬ê¸° ì™„ë£Œ');
    }

    // ì´ˆê¸° ì„¤ì •
    function createWheel() {
      setTimeout(() => {
        setCanvasSize();
        window.addEventListener('resize', setCanvasSize);
      }, 100);
    }

    // ë°ì´í„° ë¡œë“œ ì™„ë£Œ í›„ UI í‘œì‹œ
    function showGameUI() {
      console.log('ê²Œì„ UI í‘œì‹œ ì‹œì‘');
      isLoading = false;
      isDataLoaded = true;
      
      // ë¡œë”© ìƒíƒœ ìˆ¨ê¸°ê¸°
      const loadingState = document.getElementById('loadingState');
      if (loadingState) {
        loadingState.style.display = 'none';
      }
      
      // ê²Œì„ UI í‘œì‹œ
      const spinCount = document.getElementById('spinCount');
      const spinBtn = document.getElementById('spinBtn');
      
      if (spinCount) {
        spinCount.style.display = 'block';
      }
      if (spinBtn) {
        spinBtn.classList.add('loaded');
      }
      
      // ë£°ë › ë‹¤ì‹œ ê·¸ë¦¬ê¸°
      if (typeof drawWheel === 'function') {
        drawWheel();
      }
      
      console.log('ê²Œì„ UI í‘œì‹œ ì™„ë£Œ');
    }

    // í™•ë¥ ì— ë”°ë¥¸ ê²½í’ˆ ì„ íƒ
    function selectPrize() {
      const totalProbability = prizes.reduce((sum, prize) => sum + prize.probability, 0);
      let random = Math.random() * totalProbability;
      
      for (let i = 0; i < prizes.length; i++) {
        random -= prizes[i].probability;
        if (random <= 0) {
          return i;
        }
      }
      return 0;
    }


    // ê²°ê³¼ í‘œì‹œ
    function showResult(prize) {
      console.log('ê²°ê³¼ í‘œì‹œ:', prize);
      if (prizeText) {
        prizeText.textContent = prize;
      }
      if (resultModal) {
        resultModal.classList.add('show');
      }
    }

    // ëª¨ë‹¬ ë‹«ê¸°
    function closeModal() {
      console.log('ëª¨ë‹¬ ë‹«ê¸°');
      if (resultModal) {
        resultModal.classList.remove('show');
      }
      
      // ëª¨ë‹¬ì´ ë‹«íŒ í›„ ìƒíƒœ ì™„ì „ ì´ˆê¸°í™”
      setTimeout(() => {
        isSpinning = false;
        console.log('ìƒíƒœ ì´ˆê¸°í™” ì™„ë£Œ, isSpinning:', isSpinning);
      }, 100);
    }

    // Google AdSense ì´ˆê¸°í™” (ì¤‘ë³µ ë°©ì§€)
    console.log('AdSense ì´ˆê¸°í™” ì‹œì‘');
    console.log('adsbygoogle ì¡´ì¬:', typeof adsbygoogle !== 'undefined');
    
    if (typeof adsbygoogle !== 'undefined' && adsbygoogle.loaded) {
      console.log('AdSense ì´ë¯¸ ë¡œë“œë¨');
    } else {
      console.log('AdSense ì´ˆê¸°í™” ì‹œë„');
      (adsbygoogle = window.adsbygoogle || []).push({});
    }

    // SQL API ì„¤ì • ì ìš©
    window.addEventListener('DOMContentLoaded', async function() {
      console.log('DOM ë¡œë“œë¨, SQL API ì„¤ì • ì ìš© ì‹œì‘');
      
      // í™˜ê²½ ê°ì§€: ë¡œì»¬ í™˜ê²½ì—ì„œëŠ” SQL API ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
      const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
      
      if (isLocalhost) {
        console.log('ë¡œì»¬ í™˜ê²½ ê°ì§€: ê¸°ë³¸ ì„¤ì • ì‚¬ìš©');
        
        // ê¸°ë³¸ ê²½í’ˆ ë°ì´í„° ì‚¬ìš©
        prizes = defaultPrizes;
        console.log('ê¸°ë³¸ ê²½í’ˆ ë°ì´í„° ì‚¬ìš©:', prizes);
        
        // localStorageì—ì„œ ì‹œë„ íšŸìˆ˜ ë¡œë“œ
        const savedAttempts = localStorage.getItem('rouletteMaxAttempts');
        if (savedAttempts) {
          remaining = parseInt(savedAttempts);
          if (remainingText) {
            remainingText.textContent = remaining;
          }
        } else {
          remaining = 3; // ê¸°ë³¸ê°’
          if (remainingText) {
            remainingText.textContent = remaining;
          }
        }
        
        // ë¡œë”© ì™„ë£Œ
        isLoading = false;
        isDataLoaded = true;
        showGameUI();
        console.log('ë¡œì»¬ í™˜ê²½ ê²Œì„ ì„¤ì • ë¡œë”© ì™„ë£Œ');
        return;
      }
      
      // GitHub Pages í™˜ê²½: GitHub DB ìš°ì„  ì‚¬ìš©
      console.log('GitHub Pages í™˜ê²½: GitHub DB ì‚¬ìš© ì‹œë„');
      
      // GitHub DBê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
      const checkGitHubDB = () => {
        if (window.githubDB) {
          console.log('GitHub DB ë°œê²¬, ì„¤ì • ë¡œë“œ ì‹œë„');
          
          // GitHub DBì—ì„œ ë£°ë › ì„¤ì • ë¡œë“œ
          const rouletteSettings = window.githubDB.getGameSettings('roulette');
          if (rouletteSettings && rouletteSettings.prizes) {
            prizes = rouletteSettings.prizes;
            console.log('GitHub DBì—ì„œ ê²½í’ˆ ë°ì´í„° ë¡œë“œ:', prizes);
          }
          
          if (rouletteSettings && rouletteSettings.maxAttempts) {
            remaining = rouletteSettings.maxAttempts;
            if (remainingText) {
              remainingText.textContent = remaining;
            }
            console.log('GitHub DBì—ì„œ ì‹œë„ íšŸìˆ˜ ë¡œë“œ:', remaining);
          }
          
          // ë¡œë”© ì™„ë£Œ
          isLoading = false;
          isDataLoaded = true;
          showGameUI();
          console.log('GitHub DB ì„¤ì • ë¡œë”© ì™„ë£Œ');
        } else {
          console.log('GitHub DB ëŒ€ê¸° ì¤‘...');
          setTimeout(checkGitHubDB, 100);
        }
      };
      
      checkGitHubDB();
      return;
      
      try {
        // SQL API ì¡´ì¬ í™•ì¸
        if (!window.sqlAPI) {
          throw new Error('SQL APIë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        }
        
        // ì‚¬ìš©ì ë“±ë¡
        await window.sqlAPI.registerUser();
        console.log('ì‚¬ìš©ì ë“±ë¡ ì™„ë£Œ');
        
        // SQL API í†µí•© ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
        const checkSQLIntegration = async () => {
          if (window.sqlAdminIntegration) {
            console.log('SQL í†µí•© ìŠ¤í¬ë¦½íŠ¸ ë°œê²¬, ì„¤ì • ì ìš©');
            await window.sqlAdminIntegration.applyRouletteSettings();
            
            // ì„¤ì • ì ìš© í›„ ë°ì´í„° ì—…ë°ì´íŠ¸
            setTimeout(() => {
              if (window.prizeData) {
                prizes = window.prizeData;
                console.log('SQL ê²½í’ˆ ë°ì´í„° ì ìš©ë¨:', prizes);
              }
              if (window.maxAttempts) {
                remaining = window.maxAttempts;
                console.log('SQL ì‹œë„ íšŸìˆ˜ ì ìš©ë¨:', remaining);
                if (remainingText) {
                  remainingText.textContent = remaining;
                }
              }
              if (window.spinDuration) {
                console.log('SQL íšŒì „ ì‹œê°„ ì ìš©ë¨:', window.spinDuration);
              }
              
              // ë°ì´í„° ë¡œë“œ ì™„ë£Œ í›„ UI í‘œì‹œ
              showGameUI();
            }, 100);
          } else {
            console.log('SQL í†µí•© ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤, 100ms í›„ ì¬ì‹œë„');
            setTimeout(checkSQLIntegration, 100);
          }
        };
        
        checkSQLIntegration();
        
        // ì‹¤ì‹œê°„ ì„¤ì • ê°ì§€ ì‹œì‘
        if (window.sqlAdminIntegration) {
          window.sqlAdminIntegration.startSettingsWatcher(3000); // 3ì´ˆ ê°„ê²©
        }
      } catch (error) {
        console.error('SQL API ì„¤ì • ì ìš© ì‹¤íŒ¨:', error);
        console.log('í´ë°±: ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë°©ì‹ ì‚¬ìš©');
        
        // ê¸°ë³¸ ê²½í’ˆ ë°ì´í„° ì‚¬ìš©
        prizes = defaultPrizes;
        console.log('ê¸°ë³¸ ê²½í’ˆ ë°ì´í„° ì‚¬ìš©:', prizes);
        
        // localStorageì—ì„œ ì‹œë„ íšŸìˆ˜ ë¡œë“œ
        const savedAttempts = localStorage.getItem('rouletteMaxAttempts');
        if (savedAttempts) {
          remaining = parseInt(savedAttempts);
          if (remainingText) {
            remainingText.textContent = remaining;
          }
        }
        
        showGameUI();
      }
    });

    // ê´€ë¦¬ì ì„¤ì • ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    window.addEventListener('adminSettingsChanged', function(event) {
      console.log('ê´€ë¦¬ì ì„¤ì • ë³€ê²½ ì´ë²¤íŠ¸ ìˆ˜ì‹ :', event.detail);
      if (event.detail.gameType === 'roulette') {
        const settings = event.detail.settings;
        
        // ê²½í’ˆ ë°ì´í„° ì—…ë°ì´íŠ¸
        if (settings.prizes && settings.prizes.length > 0) {
          prizes = settings.prizes.map((prize, index) => ({
            id: index + 1,
            name: prize.name,
            probability: prize.probability,
            color: prize.color || '#95a5a6'
          }));
          console.log('ì‹¤ì‹œê°„ ê²½í’ˆ ë°ì´í„° ì—…ë°ì´íŠ¸:', prizes);
          
          // ë£°ë › ë‹¤ì‹œ ê·¸ë¦¬ê¸°
          if (typeof drawRoulette === 'function') {
            drawRoulette();
          }
        }
        
        // ì‹œë„ íšŸìˆ˜ ì—…ë°ì´íŠ¸
        if (settings.attempts) {
          remaining = settings.attempts;
          if (remainingText) {
            remainingText.textContent = remaining;
          }
          console.log('ì‹¤ì‹œê°„ ì‹œë„ íšŸìˆ˜ ì—…ë°ì´íŠ¸:', remaining);
        }
      }
    });
    
    // ê´‘ê³  ëª¨ë‹¬ í‘œì‹œ
    function showAdModal() {
      console.log('ê´‘ê³  ëª¨ë‹¬ í‘œì‹œ');
      const modal = document.getElementById('adModal');
      modal.classList.add('show');
      
      // ê´‘ê³  ì´ˆê¸°í™” (ëª¨ë‹¬ì´ í‘œì‹œëœ í›„)
      setTimeout(() => {
        try {
          if (typeof adsbygoogle !== 'undefined') {
            console.log('ê´‘ê³  ì´ˆê¸°í™” ì‹œë„');
            (adsbygoogle = window.adsbygoogle || []).push({});
            
            // ê´‘ê³  ë¡œë”© ì™„ë£Œ í›„ í”Œë ˆì´ìŠ¤í™€ë” ìˆ¨ê¸°ê¸°
            setTimeout(() => {
              const placeholder = document.getElementById('adPlaceholder');
              if (placeholder) {
                placeholder.style.display = 'none';
                console.log('ê´‘ê³  í”Œë ˆì´ìŠ¤í™€ë” ìˆ¨ê¹€');
              }
            }, 2000);
          } else {
            console.warn('AdSense ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            // AdSense ìŠ¤í¬ë¦½íŠ¸ê°€ ì—†ìœ¼ë©´ í”Œë ˆì´ìŠ¤í™€ë” ìœ ì§€
          }
        } catch (error) {
          console.error('ê´‘ê³  ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
        }
      }, 100);
      
      // ì¹´ìš´íŠ¸ë‹¤ìš´ì€ ìë™ìœ¼ë¡œ ì‹œì‘í•˜ì§€ ì•ŠìŒ
      // ì‚¬ìš©ìê°€ "ê²Œì„ ì‹œì‘í•˜ê¸°" ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼ë§Œ ì‹œì‘
    }
    
    // ê´‘ê³  ëª¨ë‹¬ ë‹«ê¸°
    function closeAdModal() {
      const modal = document.getElementById('adModal');
      modal.classList.remove('show');
    }
    
    // ê´‘ê³  ëª¨ë‹¬ ë‹«ê³  ìŠ¤í•€ ì‹œì‘
    function closeAdModalAndSpin() {
      console.log('X ë²„íŠ¼ìœ¼ë¡œ ëª¨ë‹¬ ë‹«ê¸°');
      closeAdModal();
      // ëª¨ë‹¬ì´ ë‹«íŒ í›„ ìŠ¤í•€ ì‹œì‘
      setTimeout(() => {
        if (!isSpinning) {
          spin();
        }
      }, 300);
    }
    
    // ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
    function startCountdown() {
      const countdown = document.getElementById('countdown');
      const countdownText = document.getElementById('countdownText');
      const startBtn = document.getElementById('startGameBtn');
      
      countdown.style.display = 'block';
      startBtn.style.display = 'none';
      
      let timeLeft = 5;
      countdownText.textContent = timeLeft;
      
      const timer = setInterval(() => {
        timeLeft--;
        countdownText.textContent = timeLeft;
        
        if (timeLeft <= 0) {
          clearInterval(timer);
          // ì¹´ìš´íŠ¸ë‹¤ìš´ ì™„ë£Œ í›„ ëª¨ë‹¬ ë‹«ê³  ê²Œì„ ì‹œì‘
          closeAdModal();
          setTimeout(() => {
            if (!isSpinning) {
              spin();
            }
          }, 300);
        }
      }, 1000);
    }
    
    // ê²Œì„ ì‹œì‘
    function startGame() {
      console.log('ê²Œì„ ì‹œì‘!');
      // ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
      startCountdown();
    }
    
    // ê´‘ê³  ê±´ë„ˆë›°ê¸°
    function skipAd() {
      console.log('ê´‘ê³  ê±´ë„ˆë›°ê¸°');
      closeAdModal();
      // ëª¨ë‹¬ì´ ë‹«íŒ í›„ ìŠ¤í•€ ì‹œì‘
      setTimeout(() => {
        if (!isSpinning) {
          spin();
        }
      }, 300);
    }
    
    // ê´‘ê³  í´ë¦­ ì¶”ì 
    function trackAdClick(adType) {
      console.log('ê´‘ê³  í´ë¦­:', adType);
      // Google Analytics ì¶”ì 
      if (typeof gtag !== 'undefined') {
        gtag('event', 'ad_click', {
          'ad_type': adType,
          'page': window.location.pathname
        });
      }
    }
  </script>
</body>
</html>

