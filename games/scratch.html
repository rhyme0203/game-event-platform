<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ°</text></svg>">
  <title>ëŸ­í‚¤ë¹¤ì“° - ìŠ¤í¬ë˜ì¹˜</title>
  <link rel="stylesheet" href="../assets/css/common.css">
  <link rel="stylesheet" href="../assets/css/ad-modal.css">
  
  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8451876651536601"
       crossorigin="anonymous"></script>
  
  <!-- AdSense ì½”ë“œ ìŠ¤ë‹ˆí« -->
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-8451876651536601",
      enable_page_level_ads: true
    });
  </script>
  <style>
    .scratch-area {
      position: relative;
      max-width: 400px;
      margin: 40px auto;
    }

    .scratch-card {
      position: relative;
      width: 100%;
      aspect-ratio: 3/2;
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      overflow: hidden;
    }

    .prize-layer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
    }

    .prize-emoji {
      font-size: 80px;
      margin-bottom: 20px;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .prize-name {
      font-size: 1.8em;
      font-weight: 700;
      text-align: center;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    #scratchCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      cursor: grab;
      touch-action: none;
    }

    #scratchCanvas:active {
      cursor: grabbing;
    }

    .scratch-instruction {
      text-align: center;
      margin-top: 30px;
      font-size: 1.1em;
      color: #666;
      font-weight: 600;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e0e0e0;
      border-radius: 10px;
      margin-top: 20px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      border-radius: 10px;
      transition: width 0.3s ease;
      width: 0%;
    }

    .progress-text {
      text-align: center;
      margin-top: 10px;
      font-size: 0.9em;
      color: #999;
    }

    @media (max-width: 600px) {
      .prize-emoji {
        font-size: 60px;
      }
      .prize-name {
        font-size: 1.4em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="game-card">
      <h1>ğŸ« ìŠ¤í¬ë˜ì¹˜ ì¹´ë“œ</h1>
      <p class="subtitle">ê¸ì–´ì„œ ê²½í’ˆì„ í™•ì¸í•˜ì„¸ìš”!</p>

      <div class="game-area">
        <div class="scratch-area">
          <div class="scratch-card">
            <div class="prize-layer" id="prizeLayer">
              <div class="prize-emoji" id="prizeEmoji">ğŸ</div>
              <div class="prize-name" id="prizeName">???</div>
            </div>
            <canvas id="scratchCanvas"></canvas>
          </div>

          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="progress-text">
            ê¸ì€ ì •ë„: <span id="progressText">0</span>%
          </div>
        </div>

        <div class="scratch-instruction">
          ğŸ‘† ì¹´ë“œë¥¼ ì†ê°€ë½ì´ë‚˜ ë§ˆìš°ìŠ¤ë¡œ ê¸ì–´ì£¼ì„¸ìš”
        </div>
      </div>

      <div class="info-box">
        <p><strong>ì°¸ì—¬ ë°©ë²•</strong></p>
        <p>íšŒìƒ‰ ì˜ì—­ì„ ê¸ì–´ì„œ ìˆ¨ê²¨ì§„ ê²½í’ˆì„ í™•ì¸í•˜ì„¸ìš”.</p>
        <p>70% ì´ìƒ ê¸ìœ¼ë©´ ìë™ìœ¼ë¡œ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤!</p>
      </div>

      <a href="../index.html" class="back-link">â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>
  </div>

  <!-- ê²°ê³¼ ëª¨ë‹¬ -->
  <div class="result-modal" id="resultModal">
    <div class="result-content">
      <div class="result-icon" id="resultIcon">ğŸ‰</div>
      <div class="result-title">ë‹¹ì²¨!</div>
      <div class="result-prize" id="resultText"></div>
      <button class="close-button" id="closeBtn">í™•ì¸</button>
    </div>
  </div>

  <!-- ê´‘ê³  ëª¨ë‹¬ -->
  <div class="ad-modal" id="adModal">
    <div class="ad-modal-content">
      <button class="ad-modal-close" onclick="closeAdModalAndContinue()">&times;</button>
      
      <div class="ad-modal-header">
        <div class="ad-modal-title">ğŸ¯ íŠ¹ë³„ ì´ë²¤íŠ¸!</div>
        <div class="ad-modal-subtitle">ëŸ­í‚¤ë¹¤ì“° í”„ë¦¬ë¯¸ì—„ ì„œë¹„ìŠ¤ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”</div>
      </div>
      
      <div class="ad-modal-body">
        <div class="ad-modal-ad">
          <!-- Google AdSense ê´‘ê³  -->
          <ins class="adsbygoogle"
               style="display:block;width:300px;height:250px;"
               data-ad-client="ca-pub-8451876651536601"
               data-ad-slot="5939741579"></ins>
          <div class="ad-modal-ad-placeholder" style="display:none;">
            ê´‘ê³  ë¡œë”© ì¤‘...
          </div>
        </div>
        
        <div class="ad-modal-countdown" id="countdown" style="display:none;">
          <span id="countdownText">5</span>ì´ˆ í›„ ê³„ì†í•˜ê¸°
        </div>
      </div>
      
      <div class="ad-modal-footer">
        <button class="ad-modal-btn ad-modal-btn-primary" onclick="continueScratching()" id="continueBtn">
          ê³„ì† ê¸ê¸°
        </button>
        <button class="ad-modal-btn ad-modal-btn-secondary" onclick="skipAdAndContinue()">
          ê´‘ê³  ê±´ë„ˆë›°ê¸°
        </button>
      </div>
    </div>
  </div>

  <script>
    const prizes = [
      { name: 'ğŸŠ ëŒ€ë°•! 50,000ì› ìƒí’ˆê¶Œ', emoji: 'ğŸ’', isJackpot: true },
      { name: 'ì¶•í•˜í•©ë‹ˆë‹¤! 10,000ì› ìƒí’ˆê¶Œ', emoji: 'ğŸ', isJackpot: false },
      { name: 'ë‹¹ì²¨! 5,000 í¬ì¸íŠ¸', emoji: 'â­', isJackpot: false },
      { name: 'ì¶•í•˜í•´ìš”! 3,000 í¬ì¸íŠ¸', emoji: 'ğŸ«', isJackpot: false },
      { name: 'ë‹¹ì²¨! 1,000 í¬ì¸íŠ¸', emoji: 'ğŸª', isJackpot: false },
      { name: '500 í¬ì¸íŠ¸ íšë“!', emoji: 'ğŸ¯', isJackpot: false },
      { name: 'ì•„ì‰½ë„¤ìš”. ë‹¤ìŒ ê¸°íšŒì—!', emoji: 'ğŸ˜¢', isJackpot: false }
    ];

    const canvas = document.getElementById('scratchCanvas');
    const ctx = canvas.getContext('2d');
    const prizeEmoji = document.getElementById('prizeEmoji');
    const prizeName = document.getElementById('prizeName');
    const progressFill = document.getElementById('progressFill');
    const progressText = document.getElementById('progressText');
    const resultModal = document.getElementById('resultModal');
    const resultIcon = document.getElementById('resultIcon');
    const resultText = document.getElementById('resultText');
    const closeBtn = document.getElementById('closeBtn');

    let isDrawing = false;
    let isRevealed = false;
    let adShown = false;
    let selectedPrize;

    // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
    function initCanvas() {
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width;
      canvas.height = rect.height;

      // ì€ìƒ‰ ìŠ¤í¬ë˜ì¹˜ ë ˆì´ì–´
      ctx.fillStyle = '#c0c0c0';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // í…ìŠ¤íŠ¸
      ctx.fillStyle = '#ffffff';
      ctx.font = 'bold 24px Arial';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText('ì—¬ê¸°ë¥¼ ê¸ì–´ì£¼ì„¸ìš”!', canvas.width / 2, canvas.height / 2 - 20);
      
      ctx.font = '50px Arial';
      ctx.fillText('ğŸ', canvas.width / 2, canvas.height / 2 + 30);
    }

    // ê²½í’ˆ ì„ íƒ
    function selectPrize() {
      const randomIndex = Math.floor(Math.random() * prizes.length);
      selectedPrize = prizes[randomIndex];
      prizeName.textContent = selectedPrize.name;
      prizeEmoji.textContent = selectedPrize.emoji;
    }

    // ìŠ¤í¬ë˜ì¹˜ ê·¸ë¦¬ê¸°
    function scratch(x, y) {
      ctx.globalCompositeOperation = 'destination-out';
      ctx.beginPath();
      ctx.arc(x, y, 30, 0, 2 * Math.PI);
      ctx.fill();
    }

    // ê¸ì€ ì •ë„ ê³„ì‚°
    function calculateProgress() {
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const pixels = imageData.data;
      let transparentPixels = 0;

      for (let i = 3; i < pixels.length; i += 4) {
        if (pixels[i] === 0) {
          transparentPixels++;
        }
      }

      const progress = Math.floor((transparentPixels / (pixels.length / 4)) * 100);
      progressFill.style.width = progress + '%';
      progressText.textContent = progress;

      // 30% ì§„í–‰ ì‹œ ê´‘ê³  ëª¨ë‹¬ í‘œì‹œ
      if (progress >= 30 && !adShown) {
        adShown = true;
        showAdModal();
        return;
      }

      // 70% ì´ìƒ ê¸ìœ¼ë©´ ìë™ ì™„ë£Œ
      if (progress > 70 && !isRevealed) {
        revealPrize();
      }
    }

    // ê²½í’ˆ ì™„ì „íˆ ë“œëŸ¬ë‚´ê¸°
    function revealPrize() {
      isRevealed = true;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      progressFill.style.width = '100%';
      progressText.textContent = '100';
      
      setTimeout(() => {
        showResult();
      }, 500);
    }

    // ê²°ê³¼ ëª¨ë‹¬ í‘œì‹œ
    function showResult() {
      resultIcon.textContent = selectedPrize.emoji;
      resultText.textContent = selectedPrize.name;
      resultModal.classList.add('show');
    }

    // ëª¨ë‹¬ ë‹«ê¸° ë° ë¦¬ì…‹
    function closeModal() {
      resultModal.classList.remove('show');
      setTimeout(() => {
        resetGame();
      }, 300);
    }

    // ê´‘ê³  ëª¨ë‹¬ í‘œì‹œ
    function showAdModal() {
      console.log('ê´‘ê³  ëª¨ë‹¬ í‘œì‹œ');
      const modal = document.getElementById('adModal');
      modal.classList.add('show');
    }
    
    // ê´‘ê³  ëª¨ë‹¬ ë‹«ê¸°
    function closeAdModal() {
      const modal = document.getElementById('adModal');
      modal.classList.remove('show');
    }
    
    // ê´‘ê³  ëª¨ë‹¬ ë‹«ê³  ê³„ì†í•˜ê¸°
    function closeAdModalAndContinue() {
      console.log('X ë²„íŠ¼ìœ¼ë¡œ ëª¨ë‹¬ ë‹«ê¸°');
      closeAdModal();
      setTimeout(() => {
        continueScratching();
      }, 300);
    }
    
    // ê³„ì† ê¸ê¸°
    function continueScratching() {
      console.log('ê³„ì† ê¸ê¸°');
      closeAdModal();
      // ê¸ê¸° ì¬ê°œ
      setTimeout(() => {
        isDrawing = true;
      }, 300);
    }
    
    // ê´‘ê³  ê±´ë„ˆë›°ê³  ê³„ì†í•˜ê¸°
    function skipAdAndContinue() {
      console.log('ê´‘ê³  ê±´ë„ˆë›°ê¸°');
      closeAdModal();
      setTimeout(() => {
        continueScratching();
      }, 300);
    }

    // ê²Œì„ ë¦¬ì…‹
    function resetGame() {
      isRevealed = false;
      adShown = false;
      progressFill.style.width = '0%';
      progressText.textContent = '0';
      selectPrize();
      initCanvas();
    }

    // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
    canvas.addEventListener('mousedown', (e) => {
      isDrawing = true;
      const rect = canvas.getBoundingClientRect();
      scratch(e.clientX - rect.left, e.clientY - rect.top);
    });

    canvas.addEventListener('mousemove', (e) => {
      if (!isDrawing || isRevealed) return;
      const rect = canvas.getBoundingClientRect();
      scratch(e.clientX - rect.left, e.clientY - rect.top);
      calculateProgress();
    });

    canvas.addEventListener('mouseup', () => {
      isDrawing = false;
    });

    canvas.addEventListener('mouseleave', () => {
      isDrawing = false;
    });

    // í„°ì¹˜ ì´ë²¤íŠ¸
    canvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      isDrawing = true;
      const rect = canvas.getBoundingClientRect();
      const touch = e.touches[0];
      scratch(touch.clientX - rect.left, touch.clientY - rect.top);
    });

    canvas.addEventListener('touchmove', (e) => {
      e.preventDefault();
      if (!isDrawing || isRevealed) return;
      const rect = canvas.getBoundingClientRect();
      const touch = e.touches[0];
      scratch(touch.clientX - rect.left, touch.clientY - rect.top);
      calculateProgress();
    });

    canvas.addEventListener('touchend', () => {
      isDrawing = false;
    });

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    closeBtn.addEventListener('click', closeModal);
    resultModal.addEventListener('click', (e) => {
      if (e.target === resultModal) closeModal();
    });

    // ì´ˆê¸°í™”
    selectPrize();
    initCanvas();

    // ë¦¬ì‚¬ì´ì¦ˆ ëŒ€ì‘
    window.addEventListener('resize', () => {
      if (!isRevealed) {
        initCanvas();
      }
    });
  </script>
</body>
</html>

